<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>çµŒè²»ç²¾ç®— Pro</title>
  <style>
    /* ========== ãƒ™ãƒ¼ã‚¹è¨­å®š ========== */
    :root {
      --primary: #2563eb; --primary-dark: #1d4ed8;
      --accent: #f59e0b; 
      --bg: #f8fafc; --text: #0f172a; --sub-text: #64748b; --border: #e2e8f0;
      /* ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ã®åˆæœŸå€¤ï¼ˆæœªå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ç”¨ï¼‰ */
      --safe-top: 20px; 
      --safe-bottom: 20px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
    }
    /* iPhoneç­‰ã®ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢å–å¾— */
    @supports (padding-top: env(safe-area-inset-top)) {
      :root {
        --safe-top: env(safe-area-inset-top);
        --safe-bottom: env(safe-area-inset-bottom);
      }
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0; padding: 0; width: 100%; height: 100dvh;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 50%, #e2e8f0 100%);
      color: var(--text); font-size: 18px; overflow: hidden;
    }

    /* ã‚¢ãƒ—ãƒªå…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .app-root { 
      width: 100%; height: 100%; 
      display: flex; flex-direction: column; 
      padding-top: var(--safe-top);
      /* padding-bottomã¯å€‹åˆ¥ã®ãƒ“ãƒ¥ãƒ¼ã§åˆ¶å¾¡ã™ã‚‹ãŸã‚å‰Šé™¤ */
    }
    .view-section { 
      flex: 1; display: none; flex-direction: column; overflow: hidden; height: 100%; position: relative;
    }
    .view-section.active { display: flex; }

    /* ========== ãƒ˜ãƒƒãƒ€ãƒ¼ ========== */
    header {
      flex: 0 0 auto; height: 80px;
      padding: 0 24px; background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.95));
      backdrop-filter: blur(20px); border-bottom: 1px solid rgba(226, 232, 240, 0.6);
      display: flex; align-items: center; gap: 20px; z-index: 20;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    h1 { 
      margin: 0; font-size: 1.7rem; font-weight: 800; 
      background: linear-gradient(135deg, #2563eb, #3b82f6);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text; white-space: nowrap; letter-spacing: -0.01em;
    }
    #applicantSelector { 
      flex: 1; min-width: 0; height: 52px;
      padding: 0 20px; border-radius: 14px; border: 1px solid rgba(226, 232, 240, 0.8); 
      font-size: 1.2rem; font-weight: 600; 
      background: linear-gradient(135deg, rgba(241, 245, 249, 0.9), rgba(255, 255, 255, 0.9));
      color: var(--text); backdrop-filter: blur(8px);
      appearance: none; -webkit-appearance: none;
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
      background-repeat: no-repeat; background-position: right 20px top 50%; background-size: 16px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.06); transition: all 0.2s;
    }
    #applicantSelector:focus {
      outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .help-btn {
      width: 48px; height: 48px; background: linear-gradient(135deg, #06b6d4, #0891b2);
      color: white; border: none; border-radius: 12px; font-size: 1.3rem;
      display: flex; align-items: center; justify-content: center; cursor: pointer;
      box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3); transition: all 0.2s;
    }
    .help-btn:active { transform: scale(0.95); }
    
    .admin-switch-btn { 
      padding: 14px 20px; background: linear-gradient(135deg, #475569, #334155); color: white; border: none;
      border-radius: 14px; font-size: 1.1rem; font-weight: 600; cursor: pointer; display: none;
      box-shadow: 0 3px 10px rgba(71, 85, 105, 0.3); transition: all 0.2s; min-height: 52px;
    }
    .admin-switch-btn:active { transform: scale(0.95); }

    /* ========== ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ ========== */
    .user-main { 
      flex: 1; display: flex; flex-direction: column; background: #f1f5f9; position: relative; 
      /* ãƒ•ãƒƒã‚¿ãƒ¼ãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«ä¸‹éƒ¨ã«ä½™ç™½ã‚’æŒãŸã›ã‚‹ */
    }
    
    .cart-list { 
      flex: 1; overflow-y: auto; padding: 20px 16px; 
      /* ä¸‹éƒ¨ãƒ‰ãƒƒã‚¯ã®é«˜ã•(ç´„120px) + ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢åˆ†ã®ä½™ç™½ */
      padding-bottom: calc(140px + var(--safe-bottom));
      display: flex; flex-direction: column; gap: 16px; 
      -webkit-overflow-scrolling: touch;
    }
    .cart-empty { 
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 60%; color: var(--sub-text); gap: 2rem; text-align: center; padding: 2rem;
    }
    .cart-empty::before { content: "ğŸ“¸"; font-size: 5rem; opacity: 0.7; }
    .cart-empty::after { 
      content: "ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ’®å½±ã—ã¦\AçµŒè²»ç”³è«‹ã‚’å§‹ã‚ã¾ã—ã‚‡ã†"; 
      white-space: pre-line; font-size: 1.6rem; font-weight: 600; 
      line-height: 1.6; color: #64748b;
    }

    /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .cart-item {
      background: white; border-radius: 20px; padding: 20px; 
      display: flex; flex-direction: column; gap: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08), 0 1px 4px rgba(0,0,0,0.04); 
      transition: transform 0.1s, box-shadow 0.2s;
      border: 1px solid rgba(0,0,0,0.04);
    }
    .cart-item:active { 
      transform: scale(0.98); 
      box-shadow: 0 4px 20px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.06); 
    }
    
    .cart-item-header {
      display: flex; align-items: flex-start; gap: 16px;
    }
    
    .cart-item-content {
      flex: 1; display: flex; flex-direction: column; gap: 8px;
    }
    
    .cart-item-actions {
      display: flex; justify-content: space-between; align-items: center;
      padding-top: 12px; border-top: 1px solid #f1f5f9;
    }
    
    .cart-thumb-box { 
      width: 80px; height: 80px; border-radius: 16px; overflow: hidden; background: #f1f5f9; position: relative;
      flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .cart-thumb { width: 100%; height: 100%; object-fit: cover; }
    
    .cart-info { overflow: hidden; display: flex; flex-direction: column; gap: 6px; }
    .cart-meta { display: flex; align-items: center; gap: 8px; font-size: 1rem; color: var(--sub-text); margin-bottom: 4px; }
    .status-badge { 
      padding: 8px 14px; border-radius: 12px; background: linear-gradient(135deg, #e0f2fe, #bae6fd); 
      color: var(--primary); font-weight: 700; white-space: nowrap; font-size: 1rem;
      box-shadow: 0 1px 3px rgba(37, 99, 235, 0.2);
    }
    .cart-vendor { 
      font-weight: 700; font-size: 1.3rem; color: #1e293b;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
      line-height: 1.3;
    }
    
    .cart-amount { 
      font-size: 1.8rem; font-weight: 900; color: #059669;
      text-align: right; letter-spacing: -0.02em;
    }
    .cart-amount.zero { color: #cbd5e1; font-size: 1.5rem; }
    
    .cart-del-btn {
      padding: 14px 18px; background: #fef2f2; color: #dc2626; border: none;
      border-radius: 12px; font-weight: 600; font-size: 1.1rem; cursor: pointer;
      display: flex; align-items: center; gap: 8px; transition: all 0.2s;
      min-height: 52px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .cart-del-btn:active { background: #fee2e2; transform: scale(0.95); }

    .analyzing-overlay { 
      position: absolute; inset: 0; background: rgba(255,255,255,0.8); 
      display: flex; justify-content: center; align-items: center; 
    }
    .mini-spinner { width: 20px; height: 20px; border: 3px solid #ddd; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }

    /* ========== ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ï¼šä¸‹éƒ¨æ“ä½œãƒ‰ãƒƒã‚¯ ========== */
    .operation-dock {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: linear-gradient(to top, rgba(255,255,255,0.98), rgba(255,255,255,0.95));
      backdrop-filter: blur(20px);
      padding: 20px 24px;
      padding-bottom: calc(24px + var(--safe-bottom)); 
      border-top-left-radius: 24px; border-top-right-radius: 24px;
      box-shadow: 0 -8px 32px rgba(0,0,0,0.12), 0 -2px 8px rgba(0,0,0,0.04);
      display: flex; flex-direction: column; gap: 16px;
      z-index: 50; border-top: 1px solid rgba(0,0,0,0.06);
    }
    
    .dock-top {
      display: flex; justify-content: space-between; align-items: center;
    }
    
    .dock-bottom {
      display: flex; gap: 16px; align-items: center;
    }

    .total-block { display: flex; flex-direction: column; gap: 4px; }
    .total-label { font-size: 1.1rem; color: var(--sub-text); font-weight: 600; letter-spacing: 0.02em; }
    .total-price { 
      font-size: 2.2rem; font-weight: 900; line-height: 1.1; color: #059669;
      letter-spacing: -0.02em;
    }

    .camera-launch-btn {
      width: 140px; height: 56px; border-radius: 28px; 
      background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
      color: white; font-size: 1.8rem; font-weight: 600;
      display: flex; justify-content: center; align-items: center; gap: 8px;
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4), 0 4px 12px rgba(59, 130, 246, 0.2);
      cursor: pointer; transition: all 0.2s; border: 3px solid rgba(255,255,255,0.9);
      flex-shrink: 0;
    }
    .camera-launch-btn:active { transform: scale(0.95); box-shadow: 0 4px 16px rgba(59, 130, 246, 0.5); }

    .apply-btn {
      flex: 1; height: 60px;
      background: linear-gradient(135deg, #059669, #047857); color: white; border: none; border-radius: 16px;
      font-weight: 700; font-size: 1.3rem; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 8px;
      box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3), 0 2px 4px rgba(5, 150, 105, 0.2);
      transition: all 0.2s;
    }
    .apply-btn:disabled { 
      background: #e2e8f0; color: #94a3b8; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .apply-btn:not(:disabled):active { 
      background: linear-gradient(135deg, #047857, #065f46); transform: scale(0.98);
    }

    /* ========== ç®¡ç†è€…ç”»é¢ï¼ˆä¿®æ­£ç®‡æ‰€ï¼‰ ========== */
    .admin-main { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      background: #334155; 
      overflow: hidden; /* ã‚³ãƒ³ãƒ†ãƒŠè‡ªä½“ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ãªã„ */
      position: relative;
    }
    .admin-tools { 
      flex: 0 0 auto; 
      padding: 20px 24px; 
      background: linear-gradient(135deg, #1e293b, #0f172a); 
      display: flex; 
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .tool-btn { 
      font-size: 1rem; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; 
      border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer;
      font-weight: 600; transition: all 0.2s; min-height: 44px;
      box-shadow: 0 3px 10px rgba(59, 130, 246, 0.3);
    }
    .tool-btn:active { transform: scale(0.95); background: linear-gradient(135deg, #2563eb, #1d4ed8); }

    .card-container {
      flex: 1; /* æ®‹ã‚Šã®é«˜ã•ã‚’å…¨ã¦ä½¿ã† */
      width: 100%;
      overflow-x: auto; 
      overflow-y: hidden; /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¦æ­¢ */
      display: flex; 
      align-items: center; /* ã‚«ãƒ¼ãƒ‰ã‚’ç¸¦æ–¹å‘ä¸­å¤®å¯„ã› */
      padding: 24px 16px 16px 16px; /* ä¸Šéƒ¨ã«é‡è¤‡è­¦å‘Šãƒãƒƒã‚¸ç”¨ã‚¹ãƒšãƒ¼ã‚¹ */
      gap: 16px;
      scroll-snap-type: x mandatory; 
      -webkit-overflow-scrolling: touch;
      
      /* ä¸‹éƒ¨ãŒè¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«ã€ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢åˆ†ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ  */
      padding-bottom: calc(16px + var(--safe-bottom));
      box-sizing: border-box; 
    }
    
    .admin-card {
      flex: 0 0 90vw; /* å¹…ã¯ç”»é¢ã®90% */
      max-width: 500px;
      /* é«˜ã•ã‚’100%ã«æŒ‡å®šã—ã¦è¦ªã‚³ãƒ³ãƒ†ãƒŠã„ã£ã±ã„ã¾ã§åºƒã’ã‚‹ */
      height: 100%;
      max-height: 100%;
      scroll-snap-align: center;
      background: white; border-radius: 16px;
      display: flex; flex-direction: column;
      box-sizing: border-box;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      position: relative; overflow: hidden;
    }

    .ac-header { 
      flex: 0 0 auto; padding: 20px; background: linear-gradient(135deg, #f8fafc, #f1f5f9); border-bottom: 1px solid var(--border); 
      display: flex; justify-content: space-between; align-items: flex-start; 
    }
    .ac-user { font-size: 1.1rem; font-weight: 900; line-height: 1.3; }
    .ac-total { font-size: 1.5rem; font-weight: 900; color: var(--primary); }
    .ac-dept { font-size: 0.75rem; background: linear-gradient(135deg, #e0e7ff, #c7d2fe); padding: 4px 8px; border-radius: 6px; color: #3730a3; display: inline-block; margin-left: 6px; font-weight: 600;}
    
    .ac-body {
      flex: 1; /* ã‚«ãƒ¼ãƒ‰å†…ã§ä½™ã£ãŸéƒ¨åˆ†ã‚’åŸ‹ã‚ã‚‹ */
      overflow-y: auto; /* ã“ã“ã ã‘ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã‚‹ */
      overflow-x: hidden; /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²ã */
      padding: 16px;
      overscroll-behavior: contain;
    }

    .detail-item {
      display: flex; flex-direction: column; gap: 8px;
      margin-bottom: 20px; border-bottom: 1px dashed #e2e8f0; padding-bottom: 16px;
      width: 100%; box-sizing: border-box;
    }
    .d-row { display: flex; gap: 12px; width: 100%; box-sizing: border-box; }
    .d-thumb-box { 
      width: 70px; height: 70px; background: #000; border-radius: 8px; 
      overflow: hidden; flex-shrink: 0; position: relative; 
    }
    .d-inputs { flex: 1; display: flex; flex-direction: column; gap: 8px; min-width: 0; }
    
    input, select, textarea {
      width: 100%; padding: 18px; border: 1px solid rgba(226, 232, 240, 0.6); border-radius: 12px;
      font-size: 18px; background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.8));
      backdrop-filter: blur(8px); transition: all 0.2s; min-height: 52px; box-sizing: border-box;
      color: var(--text);
    }
    textarea { font-family: inherit; }
    input:focus, select:focus {
      outline: none; border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: rgba(255,255,255,0.95);
    }
    select option {
      background: white;
      color: var(--text);
    }

    .ac-footer { 
      flex: 0 0 auto; /* é«˜ã•ã‚’å›ºå®š */
      padding: 20px; 
      border-top: 1px solid var(--border); display: flex; gap: 12px; background: linear-gradient(135deg, #fefefe, #f9fafb); 
      /* ã‚«ãƒ¼ãƒ‰è‡ªä½“ãŒæµ®ã„ã¦ã„ã‚‹ãŸã‚ã€ã“ã“ã§ã®safe-bottomã¯ä¸è¦ */
    }
    .btn-ap { 
      flex: 2; padding: 16px 20px; background: linear-gradient(135deg, #059669, #047857); 
      color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 1.1rem; 
      cursor: pointer; transition: all 0.2s; min-height: 50px;
      box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-ap:active { transform: scale(0.98); background: linear-gradient(135deg, #047857, #065f46); }
    .btn-ap::before { content: 'âœ“'; font-size: 1.2rem; }
    
    .btn-rj {
      flex: 1; padding: 16px 20px; background: linear-gradient(135deg, #fef2f2, #fee2e2);
      color: #dc2626; border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px;
      font-weight: 700; font-size: 1.1rem; cursor: pointer; transition: all 0.2s; min-height: 50px;
      box-shadow: 0 3px 12px rgba(239, 68, 68, 0.2);
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-rj:active { transform: scale(0.98); background: linear-gradient(135deg, #fee2e2, #fecaca); }
    .btn-rj::before { content: 'Ã—'; font-size: 1.3rem; }

    .btn-rt {
      flex: 1.5; padding: 16px 20px; background: linear-gradient(135deg, #f59e0b, #ea580c);
      color: white; border: none; border-radius: 12px;
      font-weight: 700; font-size: 1.1rem; cursor: pointer; transition: all 0.2s; min-height: 50px;
      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.3);
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-rt:active { transform: scale(0.98); background: linear-gradient(135deg, #ea580c, #dc2626); }
    .btn-rt::before { content: 'â†©'; font-size: 1.2rem; }

    /* ========== ãã®ä»–ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«ç­‰ï¼‰ ========== */
    .edit-modal { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 100; 
      display: none; justify-content: center; align-items: flex-end; 
      backdrop-filter: blur(8px);
    }
    .edit-sheet { 
      width: 100%; max-width: 600px; 
      background: linear-gradient(to bottom, rgba(255,255,255,0.98), rgba(248,250,252,0.95));
      backdrop-filter: blur(20px); border-radius: 24px 24px 0 0; 
      padding: 24px; padding-bottom: calc(24px + var(--safe-bottom));
      display: flex; flex-direction: column; gap: 20px; 
      animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      max-height: 85vh; overflow-y: auto; border: 1px solid rgba(226, 232, 240, 0.3);
    }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    
    .sheet-handle { width: 40px; height: 5px; background: #cbd5e1; border-radius: 3px; margin: 0 auto 10px auto; }
    
    .edit-img-box {
      width: 100%; height: 200px; background: linear-gradient(135deg, #f8fafc, #f1f5f9); 
      border-radius: 16px; display: flex; justify-content: center; align-items: center; overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.5);
    }
    .edit-img { max-width: 100%; max-height: 100%; object-fit: contain; }
    
    .input-group label { 
      display: block; font-size: 1.1rem; color: #374151; margin-bottom: 10px; 
      font-weight: 600; letter-spacing: 0.01em;
    }
    .btn-save { 
      padding: 20px; background: linear-gradient(135deg, #059669, #047857); color: white; 
      border: none; border-radius: 16px; font-weight: 700; font-size: 1.4rem; 
      margin-top: 16px; cursor: pointer; box-shadow: 0 6px 20px rgba(5, 150, 105, 0.3);
      transition: all 0.2s; min-height: 60px;
    }
    .btn-save:active { transform: scale(0.98); background: linear-gradient(135deg, #047857, #065f46); }

    .master-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 110; display: none; justify-content: center; align-items: center; }
    .master-box { width: 90%; max-width: 350px; background: white; border-radius: 16px; padding: 20px; max-height: 70vh; display: flex; flex-direction: column; }
    .master-list { flex: 1; overflow-y: auto; margin: 16px 0; border: 1px solid var(--border); border-radius: 8px; }
    .master-item { padding: 10px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }

    .help-modal { 
      position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 120; 
      display: none; justify-content: center; align-items: center; backdrop-filter: blur(8px);
    }
    .help-content { 
      width: 95%; max-width: 500px; max-height: 85vh; background: white; border-radius: 20px; 
      overflow: hidden; display: flex; flex-direction: column;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }
    .help-header { 
      padding: 24px 24px 16px; background: linear-gradient(135deg, #06b6d4, #0891b2); 
      color: white; text-align: center;
    }
    .help-header h2 { margin: 0; font-size: 1.5rem; font-weight: 700; }
    .help-body { 
      flex: 1; overflow-y: auto; padding: 0; -webkit-overflow-scrolling: touch;
    }
    .help-section { 
      padding: 20px 24px; border-bottom: 1px solid #f1f5f9;
    }
    .help-section:last-child { border-bottom: none; }
    .help-section h3 { 
      margin: 0 0 12px; font-size: 1.2rem; color: #0f172a; display: flex; align-items: center; gap: 8px;
    }
    .help-section p { 
      margin: 0 0 8px; line-height: 1.6; color: #475569; font-size: 1rem;
    }
    .help-section ul { 
      margin: 8px 0; padding-left: 20px; color: #475569; font-size: 1rem;
    }
    .help-section li { margin: 4px 0; }
    .help-footer { 
      padding: 16px 24px; background: #f8fafc; border-top: 1px solid #e2e8f0; text-align: center;
    }

    #loadingOverlay { position: fixed; inset: 0; background: rgba(255,255,255,0.9); z-index: 200; display: none; justify-content: center; align-items: center; flex-direction: column; }
    .spinner { width: 40px; height: 40px; border: 4px solid #ddd; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    #toast { 
      position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px); 
      background: #1e293b; color: white; padding: 10px 20px; border-radius: 50px; 
      opacity: 0; transition: 0.3s; pointer-events: none; z-index: 300; 
      font-weight: bold; font-size: 0.9rem; box-shadow: var(--shadow-lg); 
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .confirm-toast { 
      position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); 
      background: white; color: #1e293b; padding: 20px; border-radius: 20px; 
      box-shadow: 0 10px 40px rgba(0,0,0,0.4); z-index: 350; width: 90%; max-width: 340px; 
      display: none; flex-direction: column; gap: 16px; animation: popUp 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }
    @keyframes popUp { from { transform: translateX(-50%) scale(0.8); opacity: 0; } to { transform: translateX(-50%) scale(1); opacity: 1; } }
    .confirm-actions { display: flex; gap: 10px; }
    .c-btn { 
      flex: 1; padding: 18px; border: none; border-radius: 12px; font-weight: 700; 
      font-size: 1.2rem; cursor: pointer; transition: all 0.2s; min-height: 52px;
    }
    .c-yes { 
      background: linear-gradient(135deg, #3b82f6, #2563eb); color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    .c-yes:active { background: linear-gradient(135deg, #2563eb, #1d4ed8); transform: scale(0.98); }
    
    .c-no { 
      background: linear-gradient(135deg, #f1f5f9, #e2e8f0); color: #475569;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .c-no:active { background: linear-gradient(135deg, #e2e8f0, #cbd5e1); transform: scale(0.98); }

    #imageModal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; z-index: 999; justify-content: center; align-items: center; }
    #zoomImg { max-width: 100%; max-height: 100%; object-fit: contain; }
    
    /* ========== é‡è¤‡è­¦å‘Šã‚¹ã‚¿ã‚¤ãƒ« ========== */
    .duplicate-warning {
      background: linear-gradient(135deg, #fef2f2, #fee2e2) !important;
      border: 2px solid #ef4444 !important;
      box-shadow: 0 4px 20px rgba(239, 68, 68, 0.3) !important;
      position: relative;
    }
    .duplicate-warning::before {
      content: "âš ï¸ é‡è¤‡ã®å¯èƒ½æ€§";
      position: absolute;
      top: 16px;
      left: 35%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
      padding: 6px 14px;
      border-radius: 14px;
      font-size: 0.8rem;
      font-weight: 700;
      box-shadow: 0 3px 12px rgba(239, 68, 68, 0.4);
      animation: pulseWarning 2s infinite;
      z-index: 10;
      white-space: nowrap;
    }
    @keyframes pulseWarning {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.05); opacity: 0.8; }
    }
    
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="app-root">
  <header>
    <h1>çµŒè²»ç²¾ç®—</h1>
    <select id="applicantSelector"><option>èª­è¾¼ä¸­...</option></select>
    <button id="helpBtn" class="help-btn" onclick="showHelp()">â“</button>
    <button id="adminBtn" class="admin-switch-btn" onclick="toggleMode()">ç®¡ç†è€…</button>
  </header>

  <div id="userView" class="view-section active">
    <div class="user-main">
      <div id="cartList" class="cart-list">
        <div class="cart-empty">ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ’®å½±ã—ã¦ãã ã•ã„</div>
      </div>
      
      <div class="operation-dock">
        <div class="dock-top">
          <div class="total-block">
            <div class="total-label">ç”³è«‹åˆè¨ˆ</div>
            <div class="total-price">Â¥<span id="totalDisplay">0</span></div>
          </div>
          <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
            <div class="camera-launch-btn" onclick="openCamera()">
              <span>ğŸ“·</span><span>æ’®å½±</span>
            </div>
            <label style="display: flex; align-items: center; gap: 6px; font-size: 0.95rem; color: #64748b; cursor: pointer; user-select: none;">
              <input type="checkbox" id="continueMode" style="width: 18px; height: 18px; cursor: pointer;">
              <span>å‰ã®æ˜ç´°ã®ç¶šã</span>
            </label>
          </div>
        </div>
        <div class="dock-bottom">
          <button id="submitBtn" class="apply-btn" onclick="submitCart()" disabled>
            <span>ğŸ’¸</span> ã¾ã¨ã‚ã¦ç”³è«‹
          </button>
        </div>
      </div>
    </div>
  </div>

  <form id="ocrForm" style="display:none;"><input type="file" id="rFile" name="receiptFile" accept="image/*" capture="environment" onchange="handleFile(this)"></form>

  <div id="editModal" class="edit-modal" onclick="if(event.target===this) closeEdit()">
    <div class="edit-sheet">
      <div class="sheet-handle"></div>
      <div class="edit-img-box">
        <img id="eImg" class="edit-img">
      </div>
      <div class="input-group">
        <label>åˆ©ç”¨æ—¥</label>
        <input type="date" id="eDate" style="padding: 12px; font-size: 1rem; border-radius: 8px; border: 1px solid #e2e8f0;">
      </div>
      <div class="input-group">
        <label>é‡‘é¡ (ç¨è¾¼)</label>
        <input type="number" id="eAmt" placeholder="0">
      </div>
      <div class="input-group">
        <label>ç¨ç‡</label>
        <select id="eTax" style="padding: 12px; font-size: 1rem; border-radius: 8px; border: 1px solid #e2e8f0;">
          <option value="10">10%</option>
          <option value="8">8%</option>
        </select>
      </div>
      <div class="input-group">
        <label>åº—å</label>
        <input type="text" id="eVen" placeholder="åº—å">
      </div>
      <div class="input-group">
        <label>ç§‘ç›®</label>
        <input type="text" id="eSub" placeholder="æ¶ˆè€—å“è²»ãªã©" onchange="updateTaxRateBySubject()">
      </div>
      <div class="input-group">
        <label>å‚™è€ƒãƒ»åˆ©ç”¨ç›®çš„</label>
        <textarea id="ePurpose" placeholder="ä¼šè­°è²»ã€æ¥å¾…ãªã©è©³ç´°ã‚’å…¥åŠ›" style="padding: 12px; font-size: 1rem; border-radius: 8px; border: 1px solid #e2e8f0; resize: vertical; min-height: 60px;"></textarea>
      </div>
      <button class="btn-save" onclick="saveEdit()">æ±ºå®š</button>
    </div>
  </div>

  <div id="adminView" class="view-section">
    <div class="admin-tools">
      <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="color: white; font-weight: 600; font-size: 0.9rem; opacity: 0.9;">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</span>
          <select id="applicantFilter" style="
            padding: 10px 14px; border-radius: 8px; border: 1px solid rgba(226, 232, 240, 0.3);
            background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,250,252,0.9));
            color: var(--text); font-size: 0.95rem; font-weight: 600; min-width: 160px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
          ">
            <option value="">å…¨ã¦ã®ç”³è«‹è€…</option>
          </select>
        </div>
        <div id="filterTotalDisplay" style="
          display: none; padding: 10px 16px; border-radius: 8px; 
          background: linear-gradient(135deg, #dcfdf4, #a7f3d0);
          color: #059669; font-weight: 700; font-size: 1rem;
          box-shadow: 0 2px 8px rgba(5, 150, 105, 0.2);
          border: 1px solid rgba(5, 150, 105, 0.2);
        ">
          ğŸ“Š åˆè¨ˆ: Â¥<span id="filterTotal">0</span>
        </div>
      </div>
      <button class="tool-btn" onclick="openSubjectMaster()">
        ğŸ“ ç§‘ç›®ãƒã‚¹ã‚¿ç®¡ç†
      </button>
    </div>
    <main class="admin-main">
      <div id="cardContainer" class="card-container">
        <div style="color:white; margin:auto; text-align:center; font-size:1.2rem; font-weight:600; opacity:0.8;">
          <div style="font-size:2rem; margin-bottom:16px;">â³</div>
          ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
        </div>
      </div>
    </main>
  </div>

  <div id="subjectModal" class="master-modal">
    <div class="master-box">
      <h3>ç§‘ç›®ãƒã‚¹ã‚¿</h3>
      <div style="display:flex; gap:8px;">
        <input id="newSubject" type="text" placeholder="æ–°ã—ã„ç§‘ç›®" style="flex:1;">
        <button onclick="addSubject()" style="padding:0 12px; background:var(--primary); color:white; border:none; border-radius:6px; font-weight:bold;">è¿½åŠ </button>
      </div>
      <div id="subjectListDiv" class="master-list"></div>
      <button onclick="document.getElementById('subjectModal').style.display='none'" style="padding:12px; background:#f1f5f9; border:none; border-radius:8px; font-weight:bold; color:#475569;">é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <div id="helpModal" class="help-modal" onclick="if(event.target===this) closeHelp()">
    <div class="help-content">
      <div class="help-header">
        <h2>ğŸ“± ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>
      </div>
      <div class="help-body">
        <div class="help-section">
          <h3>ğŸš€ åŸºæœ¬ã®ä½¿ã„æ–¹</h3>
          <p><strong>1. ãƒ¬ã‚·ãƒ¼ãƒˆæ’®å½±</strong><br>ğŸ“·æ’®å½±ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ’®å½±</p>
          <p><strong>2. å†…å®¹ç¢ºèª</strong><br>AIãŒè‡ªå‹•ã§é‡‘é¡ãƒ»åº—åãƒ»ç§‘ç›®ã‚’èª­ã¿å–ã‚Šã¾ã™</p>
          <p><strong>3. ç·¨é›†ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰</strong><br>ã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å†…å®¹ã‚’ä¿®æ­£</p>
          <p><strong>4. ç”³è«‹é€ä¿¡</strong><br>ğŸ’¸ã¾ã¨ã‚ã¦ç”³è«‹ãƒœã‚¿ãƒ³ã§é€ä¿¡</p>
        </div>
        
        <div class="help-section">
          <h3>ğŸ“¸ æ’®å½±ã®ã‚³ãƒ„</h3>
          <ul>
            <li>æ˜ã‚‹ã„å ´æ‰€ã§æ’®å½±ã™ã‚‹</li>
            <li>ãƒ¬ã‚·ãƒ¼ãƒˆå…¨ä½“ã‚’ç”»é¢ã«åã‚ã‚‹</li>
            <li>å¹³ã‚‰ãªå ´æ‰€ã«ç½®ã„ã¦çœŸä¸Šã‹ã‚‰æ’®å½±</li>
            <li>æ‰‹ã¶ã‚Œã—ãªã„ã‚ˆã†ã«ã‚†ã£ãã‚Šã¨</li>
          </ul>
        </div>

        <div class="help-section">
          <h3>ğŸ“ é•·ã„ãƒ¬ã‚·ãƒ¼ãƒˆã®æ’®å½±</h3>
          <p><strong>1æšã«åã¾ã‚‰ãªã„é•·ã„ãƒ¬ã‚·ãƒ¼ãƒˆã®å ´åˆï¼š</strong></p>
          <ol>
            <li>ã¾ãšä¸ŠåŠåˆ†ã‚’æ’®å½±</li>
            <li>ã€Œå‰ã®æ˜ç´°ã®ç¶šãã€ã«ãƒã‚§ãƒƒã‚¯âœ“</li>
            <li>ä¸‹åŠåˆ†ã‚’æ’®å½±</li>
            <li>é‡‘é¡ãŒè‡ªå‹•ã§åˆç®—ã•ã‚Œã¾ã™</li>
          </ol>
          <p style="font-size:0.95rem; color:#64748b; margin-top:8px;">â€»ç”»åƒã¯ä¸¡æ–¹ã¨ã‚‚ä¿å­˜ã•ã‚Œã€ã‚«ãƒ¼ãƒ‰ã«ã€ŒÃ—2ã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™</p>
        </div>
        
        <div class="help-section">
          <h3>âœï¸ ç·¨é›†æ©Ÿèƒ½</h3>
          <p>ãƒ¬ã‚·ãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ç·¨é›†ç”»é¢ãŒé–‹ãã¾ã™ï¼š</p>
          <ul>
            <li><strong>é‡‘é¡</strong>ï¼šèª­ã¿å–ã‚ŠãŒä¸æ­£ç¢ºãªå ´åˆã«ä¿®æ­£</li>
            <li><strong>åº—å</strong>ï¼šæ­£ã—ã„åº—èˆ—åã«å¤‰æ›´</li>
            <li><strong>ç§‘ç›®</strong>ï¼šé©åˆ‡ãªçµŒè²»ç§‘ç›®ã‚’é¸æŠ</li>
          </ul>
        </div>
        
        <div class="help-section">
          <h3>ğŸ”§ ã‚ˆãã‚ã‚‹å•é¡Œ</h3>
          <p><strong>é‡‘é¡ãŒ0å††ã«ãªã‚‹</strong><br>â†’ æ˜ã‚‹ã„å ´æ‰€ã§å†æ’®å½±ã™ã‚‹ã‹ã€æ‰‹å‹•ã§å…¥åŠ›</p>
          <p><strong>åº—åãŒèª­ã‚ãªã„</strong><br>â†’ ç·¨é›†ç”»é¢ã§æ­£ã—ã„åº—åã‚’å…¥åŠ›</p>
          <p><strong>ç§‘ç›®ãŒã‚ã‹ã‚‰ãªã„</strong><br>â†’ ç®¡ç†è€…ã«ç¢ºèªã—ã¦ãã ã•ã„</p>
        </div>
        
        <div class="help-section">
          <h3>ğŸ“‹ ç”³è«‹å‰ãƒã‚§ãƒƒã‚¯</h3>
          <ul>
            <li>âœ… é‡‘é¡ãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹</li>
            <li>âœ… åº—åãŒæ­£ã—ãå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹</li>
            <li>âœ… é©åˆ‡ãªç§‘ç›®ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹</li>
            <li>âœ… ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒãŒã¯ã£ãã‚Šè¦‹ãˆã‚‹</li>
          </ul>
        </div>
      </div>
      <div class="help-footer">
        <button onclick="closeHelp()" style="padding:12px 24px; background:#06b6d4; color:white; border:none; border-radius:12px; font-weight:bold; font-size:1.1rem;">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

</div>

<div id="confirmToast" class="confirm-toast">
  <div id="confirmMsg" style="font-weight:900; font-size:1.1rem; text-align:center;">å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ</div>
  <div class="confirm-actions">
    <button class="c-btn c-no" onclick="closeConfirm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="c-btn c-yes" id="confirmYesBtn">å®Ÿè¡Œ</button>
  </div>
</div>

<div id="returnModal" class="confirm-toast" style="display: none;">
  <div style="font-weight:900; font-size:1.1rem; text-align:center; margin-bottom: 16px;">å·®ã—æˆ»ã—ç†ç”±ã‚’å…¥åŠ›</div>
  <textarea id="returnComment" placeholder="ä¾‹: é ˜åæ›¸ãŒä¸é®®æ˜ã§ã™ã€‚å†æå‡ºã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚" rows="4" style="width: 100%; padding: 12px; font-size: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; resize: vertical;"></textarea>
  <div class="confirm-actions" style="margin-top: 16px;">
    <button class="c-btn c-no" onclick="closeReturnModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    <button class="c-btn c-yes" onclick="execReturn()">å·®ã—æˆ»ã™</button>
  </div>
</div>

<div id="loadingOverlay"><div class="spinner"></div><div id="loadText" style="margin-top:10px; font-weight:bold;">å‡¦ç†ä¸­...</div></div>
<div id="toast"></div>
<div id="imageModal" onclick="this.style.display='none'">
  <img id="zoomImg">
</div>

<script>
  let cartItems = [];
  let subjectMaster = [];
  let subjectMasterWithTax = []; // ç¨ç‡æƒ…å ±ä»˜ãç§‘ç›®ãƒã‚¹ã‚¿
  let editingId = null;
  let isAdminMode = false;
  let pendingAppId = null;
  let pendingAction = null;
  let allPendingList = []; // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ã®å…¨ãƒ‡ãƒ¼ã‚¿ä¿å­˜

  window.onload = function() {
    google.script.run.withSuccessHandler(initData).getInitData();
    // PCã§ã®æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è£œåŠ©
    const con = document.getElementById('cardContainer');
    con.addEventListener('wheel', e => {
      if(e.deltaY !== 0) {
        e.preventDefault();
        con.scrollLeft += e.deltaY;
      }
    });
  };

  function initData(data) {
    const sel = document.getElementById('applicantSelector');
    sel.innerHTML = '';
    data.list.forEach(u => {
      const op = document.createElement('option');
      op.value = u.id; op.text = u.name;
      if (normalize(u.email) === normalize(data.currentUser.email)) op.selected = true;
      sel.appendChild(op);
    });
    if (data.currentUser.role === 'ADMIN') {
      document.getElementById('adminBtn').style.display = 'block';
    }
    // ç§‘ç›®ãƒã‚¹ã‚¿ï¼ˆç¨ç‡æƒ…å ±ä»˜ãï¼‰ã‚’ä¿å­˜
    subjectMasterWithTax = data.subjectMaster || [];
  }
  function normalize(s) { return String(s||'').trim().toLowerCase(); }

  // ========== ãƒ¦ãƒ¼ã‚¶ãƒ¼æ©Ÿèƒ½ ==========
  function openCamera() { document.getElementById('rFile').click(); }
  
  function handleFile(input) {
    if (!input.files[0]) return;
    const file = input.files[0];
    const id = Date.now();
    const isContinueMode = document.getElementById('continueMode').checked;

    const reader = new FileReader();
    reader.onload = e => {
      const dataUrl = e.target.result;

      // ç¶šããƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€æœ€å¾Œã®æ˜ç´°ã«è¿½åŠ 
      if (isContinueMode && cartItems.length > 0) {
        const lastItem = cartItems[cartItems.length - 1];

        // ç”»åƒã‚’é…åˆ—ã§ä¿æŒï¼ˆåˆå›ã¯é…åˆ—åŒ–ï¼‰
        if (!Array.isArray(lastItem.imgData)) {
          lastItem.imgData = [lastItem.imgData];
        }
        lastItem.imgData.push(dataUrl);

        lastItem.status = 'analyzing';
        renderCart();
        showToast('ç¶šãã‚’è§£æä¸­...');

        const base64 = dataUrl.split(',')[1];
        const mimeType = dataUrl.substring(dataUrl.indexOf(':') + 1, dataUrl.indexOf(';'));

        google.script.run.withSuccessHandler(res => {
          lastItem.status = 'done';
          lastItem.amount += res.ocr.amount; // é‡‘é¡ã‚’åŠ ç®—

          // receiptUrlã‚‚é…åˆ—ã§ä¿æŒ
          if (!Array.isArray(lastItem.receiptUrl)) {
            lastItem.receiptUrl = [lastItem.receiptUrl];
          }
          lastItem.receiptUrl.push(res.receiptUrl);

          renderCart();
          showToast('ç¶šãã‚’è¿½åŠ : +Â¥' + res.ocr.amount.toLocaleString());
          document.getElementById('continueMode').checked = false; // ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™
        }).withFailureHandler(e => {
          lastItem.status = 'error';
          renderCart();
          showToast('è§£æå¤±æ•—: æ‰‹å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        }).uploadReceiptForOcr(base64, mimeType);

      } else {
        // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼šæ–°ã—ã„æ˜ç´°ã‚’ä½œæˆ
        const today = new Date().toISOString().split('T')[0];
        const item = { id: id, status: 'analyzing', amount: 0, vendor: '', subject: '', invoiceReg: 'ä¸æ˜', taxRate: 10, usageDate: today, purpose: '', imgData: dataUrl, receiptUrl: null };
        cartItems.push(item);
        renderCart();
        showToast('è§£æã‚’é–‹å§‹ã—ã¾ã—ãŸ');

        const base64 = dataUrl.split(',')[1];
        const mimeType = dataUrl.substring(dataUrl.indexOf(':') + 1, dataUrl.indexOf(';'));

        google.script.run.withSuccessHandler(res => {
          const target = cartItems.find(i => i.id === id);
          if(target) {
            target.status = 'done';
            target.amount = res.ocr.amount;
            target.vendor = res.ocr.vendor;
            target.subject = res.ocr.subject;
            target.invoiceReg = res.ocr.invoiceReg || 'ä¸æ˜';
            target.taxRate = res.ocr.taxRate || 10;
            target.usageDate = res.ocr.date || today;
            target.receiptUrl = res.receiptUrl;
            renderCart();
            showToast('è§£æå®Œäº†: ' + (target.vendor || 'åº—åä¸æ˜'));
          }
        }).withFailureHandler(e => {
          const target = cartItems.find(i => i.id === id);
          if(target) {
            target.status = 'error';
            renderCart();
            showToast('è§£æå¤±æ•—: æ‰‹å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
          }
        }).uploadReceiptForOcr(base64, mimeType);
      }

      setTimeout(() => { document.getElementById('rFile').value = ''; }, 500);
    };
    reader.readAsDataURL(file);
  }

  function renderCart() {
    const list = document.getElementById('cartList');
    list.innerHTML = '';
    let total = 0;

    if(cartItems.length === 0) {
      list.innerHTML = '<div class="cart-empty">ãƒ¬ã‚·ãƒ¼ãƒˆã‚’æ’®å½±ã—ã¦ãã ã•ã„</div>';
      document.getElementById('totalDisplay').innerText = '0';
      document.getElementById('submitBtn').disabled = true;
      return;
    }

    cartItems.forEach((item) => {
      total += Number(item.amount || 0);
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.onclick = (e) => {
        if(!e.target.closest('.cart-del-btn')) openEdit(item.id);
      };

      let overlay = item.status === 'analyzing' ? `<div class="analyzing-overlay"><div class="mini-spinner"></div></div>` : '';
      let amtClass = item.amount > 0 ? 'cart-amount' : 'cart-amount zero';
      let amtText = item.amount > 0 ? `Â¥${item.amount.toLocaleString()}` : 'Â¥ -';
      let statusText = item.status === 'analyzing' ? 'è§£æä¸­...' : (item.vendor || 'åº—åä¸æ˜');

      // ç”»åƒãŒé…åˆ—ã®å ´åˆã€æœ€åˆã®ç”»åƒã‚’è¡¨ç¤ºã—ã€æšæ•°ãƒãƒƒã‚¸ã‚’è¿½åŠ 
      const imgSrc = Array.isArray(item.imgData) ? item.imgData[0] : item.imgData;
      const imgCount = Array.isArray(item.imgData) ? item.imgData.length : 1;
      const imgBadge = imgCount > 1 ? `<div style="position:absolute; top:4px; right:4px; background:#3b82f6; color:white; border-radius:8px; padding:2px 8px; font-size:0.8rem; font-weight:700; box-shadow:0 2px 4px rgba(0,0,0,0.2);">Ã—${imgCount}</div>` : '';

      div.innerHTML = `
        <div class="cart-item-header">
          <div class="cart-thumb-box">
            <img src="${imgSrc}" class="cart-thumb">
            ${imgBadge}
            ${overlay}
          </div>
          <div class="cart-item-content">
            <div class="cart-info">
              <div class="cart-meta">${item.subject ? `<span class="status-badge">${item.subject}</span>` : ''}</div>
              <div class="cart-vendor">${statusText}</div>
            </div>
          </div>
        </div>
        <div class="cart-item-actions">
          <div class="${amtClass}">${amtText}</div>
          <button class="cart-del-btn" onclick="event.stopPropagation(); delCart(${item.id})">
            <span>ğŸ—‘ï¸</span> å‰Šé™¤
          </button>
        </div>
      `;
      list.appendChild(div);
    });
    document.getElementById('totalDisplay').textContent = total.toLocaleString();
    document.getElementById('submitBtn').disabled = false;
  }

  function delCart(id) {
    if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    cartItems = cartItems.filter(i => i.id !== id);
    renderCart();
  }

  function openEdit(id) {
    const item = cartItems.find(i => i.id === id);
    if(!item) return;
    editingId = id;

    // è¤‡æ•°ç”»åƒã«å¯¾å¿œ
    const imgBox = document.querySelector('.edit-img-box');
    imgBox.innerHTML = '';
    if (Array.isArray(item.imgData)) {
      item.imgData.forEach((img, idx) => {
        const imgEl = document.createElement('img');
        imgEl.src = img;
        imgEl.className = 'edit-img';
        imgEl.style.marginBottom = idx < item.imgData.length - 1 ? '12px' : '0';
        imgBox.appendChild(imgEl);
      });
    } else {
      const imgEl = document.createElement('img');
      imgEl.src = item.imgData;
      imgEl.className = 'edit-img';
      imgBox.appendChild(imgEl);
    }

    document.getElementById('eDate').value = item.usageDate || new Date().toISOString().split('T')[0];
    document.getElementById('eAmt').value = item.amount || '';
    document.getElementById('eTax').value = item.taxRate || 10;
    document.getElementById('eVen').value = item.vendor || '';
    document.getElementById('eSub').value = item.subject || '';
    document.getElementById('ePurpose').value = item.purpose || '';
    document.getElementById('editModal').style.display = 'flex';
  }

  function saveEdit() {
    const item = cartItems.find(i => i.id === editingId);
    if(item) {
      item.usageDate = document.getElementById('eDate').value;
      item.amount = Number(document.getElementById('eAmt').value);
      item.taxRate = Number(document.getElementById('eTax').value);
      item.vendor = document.getElementById('eVen').value;
      item.subject = document.getElementById('eSub').value;
      item.purpose = document.getElementById('ePurpose').value;
      if(item.status !== 'analyzing') item.status = 'done';
    }
    renderCart();
    document.getElementById('editModal').style.display = 'none';
  }

  // ç§‘ç›®å¤‰æ›´æ™‚ã«ç¨ç‡ã‚’è‡ªå‹•æ›´æ–°
  function updateTaxRateBySubject() {
    const subjectName = document.getElementById('eSub').value;
    const subjectData = subjectMasterWithTax.find(s => s.name === subjectName);
    if (subjectData) {
      document.getElementById('eTax').value = subjectData.taxRate;
    }
  }
  function closeEdit() { document.getElementById('editModal').style.display = 'none'; }

  function submitCart() {
    if(cartItems.length === 0) return;
    const invalid = cartItems.some(i => !i.amount || i.amount <= 0);
    if(invalid) return showToast('é‡‘é¡ãŒæœªå…¥åŠ›ã®æ˜ç´°ãŒã‚ã‚Šã¾ã™ï¼', 'error');
    const analyzing = cartItems.some(i => i.status === 'analyzing');
    if(analyzing) return showToast('è§£æä¸­ã®æ˜ç´°ãŒã‚ã‚Šã¾ã™', 'error');

    if(!confirm(`åˆè¨ˆ Â¥${document.getElementById('totalDisplay').innerText} ã§ç”³è«‹ã—ã¾ã™ã‹ï¼Ÿ`)) return;

    const applicantId = document.getElementById('applicantSelector').value;
    const data = { applicantId: applicantId, items: cartItems };

    showLoad('ç”³è«‹é€ä¿¡ä¸­...');
    google.script.run.withSuccessHandler(res => {
      hideLoad();
      showToast('ç”³è«‹ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
      cartItems = []; renderCart();
    }).withFailureHandler(e => {
      hideLoad(); showToast('ã‚¨ãƒ©ãƒ¼: ' + e.message, 'error');
    }).createApplicationWithDetails(data);
  }

  // ========== ç®¡ç†è€…æ©Ÿèƒ½ ==========
  function toggleMode() {
    const btn = document.getElementById('adminBtn');
    if (!isAdminMode) {
      isAdminMode = true;
      document.getElementById('userView').classList.remove('active');
      document.getElementById('adminView').classList.add('active');
      btn.innerText = 'ç”³è«‹ã¸';
      loadAdminData();
    } else {
      isAdminMode = false;
      document.getElementById('adminView').classList.remove('active');
      document.getElementById('userView').classList.add('active');
      btn.innerText = 'ç®¡ç†è€…';
    }
  }

  function loadAdminData() {
    showLoad('ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
    google.script.run.withSuccessHandler(res => {
      hideLoad();
      subjectMaster = res.subjectList;
      allPendingList = res.pendingList; // å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      populateApplicantFilter(res.pendingList); // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é¸æŠè‚¢ã‚’è¨­å®š
      renderAdminCards(res.pendingList);
    }).withFailureHandler(e => {
      hideLoad(); showToast('å–å¾—å¤±æ•—: ' + e.message, 'error');
    }).getAdminDashboardData();
  }

  function renderAdminCards(list) {
    const con = document.getElementById('cardContainer');
    con.innerHTML = '';
    if (list.length === 0) { 
      con.innerHTML = `
        <div style="color:white; margin:auto; text-align:center; font-size:1.2rem; font-weight:600; opacity:0.8;">
          <div style="font-size:3rem; margin-bottom:16px;">âœ…</div>
          <div>æ‰¿èªå¾…ã¡ã®ç”³è«‹ã¯ã‚ã‚Šã¾ã›ã‚“</div>
          <div style="font-size:1rem; margin-top:8px; opacity:0.6;">å…¨ã¦ã®ç”³è«‹ãŒå‡¦ç†æ¸ˆã¿ã§ã™</div>
        </div>
      `; 
      return; 
    }

    // é‡è¤‡ãƒã‚§ãƒƒã‚¯ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
    const duplicateMap = {};
    list.forEach(app => {
      app.details.forEach(detail => {
        const key = `${app.applicant}_${detail.vendor}_${detail.amount}`;
        if (!duplicateMap[key]) {
          duplicateMap[key] = [];
        }
        duplicateMap[key].push({ appId: app.appId, detailId: detail.detailId });
      });
    });

    list.forEach(app => {
      const card = document.createElement('div');
      card.className = 'admin-card';
      card.id = 'card-' + app.appId;
      
      // ã“ã®ç”³è«‹ã«é‡è¤‡ãŒã‚ã‚‹æ˜ç´°ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
      const hasDuplicates = app.details.some(detail => {
        const key = `${app.applicant}_${detail.vendor}_${detail.amount}`;
        return duplicateMap[key] && duplicateMap[key].length > 1;
      });
      
      if (hasDuplicates) {
        card.classList.add('duplicate-warning');
      }
      
      const head = `
        <div class="ac-header">
          <div>
            <div class="ac-user">${app.applicant} <span class="ac-dept">${app.dept || '-'}</span></div>
            <div style="font-size:0.8rem; color:#64748b;">${app.date}</div>
          </div>
          <div class="ac-total">Â¥${Number(app.totalAmount).toLocaleString()}</div>
        </div>
      `;

      let bodyHtml = '<div class="ac-body">';
      app.details.forEach(d => {
        let subOpts = subjectMaster.map(s => `<option value="${s}" ${s===d.subject?'selected':''}>${s}</option>`).join('');
        const imgId = `img-${d.detailId}`;
        if(d.hasImage) loadOneImage(d.fileId, imgId);

        // ã“ã®æ˜ç´°ãŒé‡è¤‡ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        const detailKey = `${app.applicant}_${d.vendor}_${d.amount}`;
        const isDuplicate = duplicateMap[detailKey] && duplicateMap[detailKey].length > 1;
        
        const invOpts = ['ã‚ã‚Š', 'ãªã—', 'ä¸æ˜'].map(v =>
          `<option value="${v}" ${v===(d.invoiceReg||'ä¸æ˜')?'selected':''}>${v}</option>`
        ).join('');

        const taxOpts = [10, 8].map(t =>
          `<option value="${t}" ${t===(d.taxRate||10)?'selected':''}>${t}%</option>`
        ).join('');

        bodyHtml += `
          <div class="detail-item" id="det-${d.detailId}" ${isDuplicate ? 'style="background: linear-gradient(135deg, #fef2f2, #fee2e2); border-left: 4px solid #ef4444; padding: 12px 0 12px 12px; box-sizing: border-box;"' : ''}>
            ${isDuplicate ? '<div style="font-size: 0.8rem; color: #dc2626; font-weight: 700; margin-bottom: 8px;">âš ï¸ é‡è¤‡ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</div>' : ''}
            <div class="d-row">
              <div class="d-thumb-box" onclick="zoomImage('${imgId}')">
                <img id="${imgId}" class="d-thumb" style="width:100%; height:100%; object-fit:cover;" src="">
              </div>
              <div class="d-inputs">
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">åˆ©ç”¨æ—¥</label>
                  <input type="date" class="d-date" value="${d.usageDate || ''}" style="font-size: 0.9rem; padding: 8px; box-sizing: border-box;">
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">åº—å</label>
                  <input type="text" class="d-vendor" value="${d.vendor}" placeholder="åº—å" style="font-size: 0.9rem; padding: 8px; box-sizing: border-box;">
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">é‡‘é¡ï¼ˆå††ï¼‰</label>
                  <input type="number" class="d-amount" value="${d.amount}" placeholder="é‡‘é¡" style="font-size: 0.9rem; padding: 8px; box-sizing: border-box;">
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">ç¨ç‡</label>
                  <select class="d-taxrate" style="font-size: 0.9rem; padding: 8px; box-sizing: border-box;">${taxOpts}</select>
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">ç§‘ç›®</label>
                  <select class="d-subject" style="font-size: 0.9rem; padding: 8px; box-sizing: border-box;">${subOpts}</select>
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">ã‚¤ãƒ³ãƒœã‚¤ã‚¹ç™»éŒ²</label>
                  <select class="d-invoice" style="font-size: 0.9rem; padding: 8px; box-sizing: border-box;">${invOpts}</select>
                </div>
                <div style="display: flex; flex-direction: column; gap: 4px; box-sizing: border-box;">
                  <label style="font-size: 0.75rem; font-weight: 600; color: #64748b;">å‚™è€ƒãƒ»åˆ©ç”¨ç›®çš„</label>
                  <textarea class="d-purpose" placeholder="ä¼šè­°è²»ã€æ¥å¾…ãªã©" rows="2" style="font-size: 0.9rem; padding: 8px; resize: vertical; box-sizing: border-box; min-height: auto;">${d.purpose || ''}</textarea>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      bodyHtml += '</div>';
      
      card.innerHTML = head + bodyHtml;

      const foot = document.createElement('div');
      foot.className = 'ac-footer';

      const btnRj = document.createElement('button');
      btnRj.className = 'btn-rj';
      btnRj.innerText = 'å´ä¸‹';
      btnRj.onclick = function() { openConfirm(app.appId, 'reject'); };

      const btnRt = document.createElement('button');
      btnRt.className = 'btn-rt';
      btnRt.innerText = 'å·®ã—æˆ»ã—';
      btnRt.onclick = function() { openReturnModal(app.appId); };

      const btnAp = document.createElement('button');
      btnAp.className = 'btn-ap';
      btnAp.innerText = 'æ‰¿èª';
      btnAp.onclick = function() { openConfirm(app.appId, 'approve'); };

      foot.appendChild(btnRj);
      foot.appendChild(btnRt);
      foot.appendChild(btnAp);
      card.appendChild(foot);

      con.appendChild(card);
    });
  }

  function loadOneImage(fileId, imgDomId) {
    google.script.run.withSuccessHandler(b64 => {
      if(b64) document.getElementById(imgDomId).src = b64;
    }).api_getReceiptImage(fileId);
  }

  function openConfirm(appId, action) {
    pendingAppId = appId;
    pendingAction = action;
    const msg = action === 'approve' ? 'ã“ã®å†…å®¹ã§æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ' : 'å´ä¸‹ã—ã¾ã™ã‹ï¼Ÿ';
    document.getElementById('confirmMsg').innerText = msg;
    const yesBtn = document.getElementById('confirmYesBtn');
    yesBtn.onclick = function() { execProcess(); };
    document.getElementById('confirmToast').style.display = 'flex';
  }

  function closeConfirm() {
    document.getElementById('confirmToast').style.display = 'none';
    pendingAppId = null;
    pendingAction = null;
  }

  function execProcess() {
    const appId = pendingAppId;
    const action = pendingAction;
    closeConfirm();

    const card = document.getElementById('card-' + appId);
    const details = [];
    card.querySelectorAll('.detail-item').forEach(row => {
      const dId = row.id.replace('det-', '');
      const date = row.querySelector('.d-date').value;
      const sub = row.querySelector('.d-subject').value;
      const ven = row.querySelector('.d-vendor').value;
      const amt = row.querySelector('.d-amount').value;
      const tax = row.querySelector('.d-taxrate').value;
      const inv = row.querySelector('.d-invoice').value;
      const pur = row.querySelector('.d-purpose').value;
      details.push({ detailId: dId, usageDate: date, subject: sub, vendor: ven, amount: amt, taxRate: tax, invoiceReg: inv, purpose: pur });
    });

    card.style.transition = 'opacity 0.3s, transform 0.3s';
    card.style.opacity = '0';
    card.style.transform = 'translateY(-20px)';
    setTimeout(() => card.remove(), 300);

    google.script.run.withSuccessHandler(() => {
      showToast('å‡¦ç†å®Œäº†');
    }).withFailureHandler(e => {
      showToast('ã‚¨ãƒ©ãƒ¼: ' + e.message, 'error');
    }).processApplicationWithEdit(appId, action, details);
  }

  function openReturnModal(appId) {
    pendingAppId = appId;
    document.getElementById('returnComment').value = '';
    document.getElementById('returnModal').style.display = 'flex';
  }

  function closeReturnModal() {
    document.getElementById('returnModal').style.display = 'none';
    pendingAppId = null;
  }

  function execReturn() {
    const appId = pendingAppId;
    const comment = document.getElementById('returnComment').value;
    closeReturnModal();

    const card = document.getElementById('card-' + appId);
    const details = [];
    card.querySelectorAll('.detail-item').forEach(row => {
      const dId = row.id.replace('det-', '');
      const date = row.querySelector('.d-date').value;
      const sub = row.querySelector('.d-subject').value;
      const ven = row.querySelector('.d-vendor').value;
      const amt = row.querySelector('.d-amount').value;
      const tax = row.querySelector('.d-taxrate').value;
      const inv = row.querySelector('.d-invoice').value;
      const pur = row.querySelector('.d-purpose').value;
      details.push({ detailId: dId, usageDate: date, subject: sub, vendor: ven, amount: amt, taxRate: tax, invoiceReg: inv, purpose: pur });
    });

    card.style.transition = 'opacity 0.3s, transform 0.3s';
    card.style.opacity = '0';
    card.style.transform = 'translateY(-20px)';
    setTimeout(() => card.remove(), 300);

    google.script.run.withSuccessHandler(() => {
      showToast('å·®ã—æˆ»ã—ã‚’å®Ÿè¡Œã—ã¾ã—ãŸ');
    }).withFailureHandler(e => {
      showToast('ã‚¨ãƒ©ãƒ¼: ' + e.message, 'error');
    }).processReturn(appId, comment, details);
  }

  // ç§‘ç›®ãƒã‚¹ã‚¿
  function openSubjectMaster() { renderSubjectList(); document.getElementById('subjectModal').style.display = 'flex'; }
  function renderSubjectList() {
    const div = document.getElementById('subjectListDiv');
    div.innerHTML = subjectMaster.map(s => 
      `<div class="master-item"><span>${s}</span><span class="del-sub" onclick="delSubject('${s}')" style="color:red; cursor:pointer; padding:4px;">âœ•</span></div>`
    ).join('');
  }
  function addSubject() {
    const val = document.getElementById('newSubject').value;
    if(!val) return;
    google.script.run.withSuccessHandler(list => {
      subjectMaster = list; renderSubjectList(); document.getElementById('newSubject').value='';
    }).api_addSubject(val);
  }
  function delSubject(val) {
    if(!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
    google.script.run.withSuccessHandler(list => {
      subjectMaster = list; renderSubjectList();
    }).api_deleteSubject(val);
  }

  function showLoad(txt) { document.getElementById('loadText').innerText=txt; document.getElementById('loadingOverlay').style.display='flex'; }
  function hideLoad() { document.getElementById('loadingOverlay').style.display='none'; }
  function showToast(msg, type='normal') { 
    const t = document.getElementById('toast'); t.innerText=msg; 
    t.style.background = type==='error' ? '#ef4444' : '#1e293b';
    t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2000); 
  }
  function zoomImage(imgId) {
    const src = document.getElementById(imgId).src;
    if(src) { document.getElementById('zoomImg').src = src; document.getElementById('imageModal').style.display = 'flex'; }
  }
  
  // ========== ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ ==========
  function populateApplicantFilter(pendingList) {
    const filter = document.getElementById('applicantFilter');
    const applicants = [...new Set(pendingList.map(app => app.applicant))].sort();
    
    // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ï¼ˆã€Œå…¨ã¦ã®ç”³è«‹è€…ã€ä»¥å¤–ï¼‰
    while (filter.children.length > 1) {
      filter.removeChild(filter.lastChild);
    }
    
    // ç”³è«‹è€…ãƒªã‚¹ãƒˆã‚’è¿½åŠ 
    applicants.forEach(name => {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      filter.appendChild(option);
    });
    
    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
    filter.onchange = applyApplicantFilter;
  }
  
  function applyApplicantFilter() {
    const selectedApplicant = document.getElementById('applicantFilter').value;
    const filteredList = selectedApplicant 
      ? allPendingList.filter(app => app.applicant === selectedApplicant)
      : allPendingList;
    
    // åˆè¨ˆé‡‘é¡ã‚’è¨ˆç®—
    const totalAmount = filteredList.reduce((sum, app) => sum + Number(app.totalAmount || 0), 0);
    
    // åˆè¨ˆé‡‘é¡è¡¨ç¤ºã®æ›´æ–°
    const totalDisplay = document.getElementById('filterTotalDisplay');
    const totalSpan = document.getElementById('filterTotal');
    
    if (selectedApplicant && filteredList.length > 0) {
      totalSpan.textContent = totalAmount.toLocaleString();
      totalDisplay.style.display = 'block';
    } else {
      totalDisplay.style.display = 'none';
    }
    
    renderAdminCards(filteredList);
  }

  function showHelp() {
    document.getElementById('helpModal').style.display = 'flex';
  }
  function closeHelp() {
    document.getElementById('helpModal').style.display = 'none';
  }
</script>
</body>
</html>